#!/bin/bash
#PBS -l nodes=2:ppn=8
#PBS -N dakota_rafem_cem

## Send email when the job is aborted, started, or stopped
#PBS -m abe

## Send email here
#PBS -M k.ratliff@duke.edu

export MPI=/opt/openmpi
export DAKOTA=/usr/local/dakota

export PATH=$DAKOTA/bin:$MPI/bin:$PATH
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$DAKOTA/bin:$DAKOTA/lib

OUTPUT_DIR=/scratch/kara5380/model_output
RUN_DIR=/scratch/kara5380/run_files

echo "Copy input to compute node..."
mkdir -p ${RUN_DIR}
cd ${RUN_DIR} && cp -r ${PBS_O_WORKDIR}/* .

echo "Run Dakota on in the temporary location."
cd ${RUN_DIR} && $DAKOTA/bin/dakota -i dakota.in

echo "Copy everything back to the head node."
mkdir -p ${OUTPUT_DIR} && cp -r ${RUN_DIR} ${OUTPUT_DIR}